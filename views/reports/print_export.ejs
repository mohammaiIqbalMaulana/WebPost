<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            a[href]:after { content: "" !important; }
        }
        .thumb {
            max-width: 120px; max-height: 120px; object-fit: cover;
        }
    </style>
</head>
<body class="p-4">
    <div class="no-print mb-3 d-flex gap-2">
        <a href="/reports/print" class="btn btn-secondary"><i class="bi bi-arrow-left"></i></a>
        <button class="btn btn-primary" onclick="window.print()"><i class="bi bi-printer me-1"></i> Print</button>
    </div>
    <h3 class="mb-3">Laporan Periode <%= start_date %> s/d <%= end_date %></h3>
    <table class="table table-bordered align-middle">
        <thead class="table-light">
            <tr>
                <th width="40">No</th>
                <th>Judul</th>
                <th>Tanggal Post</th>
                <th>Insight</th>
                <% if (includeThumbs) { %>
                    <th>Konten</th>
                <% } %>
            </tr>
        </thead>
        <tbody>
        <% if (reports.length === 0) { %>
            <tr>
                <td colspan="5" class="text-center text-muted">Tidak ada data pada rentang tanggal</td>
            </tr>
        <% } %>
        <% reports.forEach((r, i)=> { %>
            <tr>
                <td class="text-center"><%= i+1 %></td>
                <td style="max-width: 420px; overflow-wrap:anywhere;">
                    <div class="fw-semibold"><%= r.judul %></div>
                    <div><a href="<%= r.post_url %>"><%= r.post_url %></a></div>
                </td>
                <td><%= typeof formatDate === 'function' ? formatDate(r.post_date) : r.post_date %></td>
                <td>
                    <% 
                      const like = r.like_count || 0;
                      const comment = r.comment_count || 0;
                      const share = r.share_count || 0;
                      const save = r.save_count || 0;
                      const view = r.view_count || 1; // hindari pembagi 0
                      const er = ((like + comment + share + save) / view * 100);
                    %>
                    <div class="small">
                        <% if (Array.isArray(insights) ? insights.includes('view') : true) { %>
                          <div><strong>View:</strong> <%= view.toLocaleString() %></div>
                        <% } %>
                        <% if (Array.isArray(insights) ? insights.includes('like') : true) { %>
                          <div><strong>Like:</strong> <%= like.toLocaleString() %></div>
                        <% } %>
                        <% if (Array.isArray(insights) ? insights.includes('comment') : true) { %>
                          <div><strong>Comment:</strong> <%= comment.toLocaleString() %></div>
                        <% } %>
                        <% if (Array.isArray(insights) ? insights.includes('share') : true) { %>
                          <div><strong>Share:</strong> <%= share.toLocaleString() %></div>
                        <% } %>
                        <% if (Array.isArray(insights) ? insights.includes('save') : true) { %>
                          <div><strong>Save:</strong> <%= save.toLocaleString() %></div>
                        <% } %>
                        <% if (Array.isArray(insights) ? insights.includes('er') : true) { %>
                          <div><strong>ER:</strong> <%= er.toFixed(2) %>%</div>
                        <% } %>
                    </div>
                </td>
                <% if (includeThumbs) { %>
                <td>
                    <% if (r.image_path) { %>
                        <img src="/<%= r.image_path %>" class="thumb border" />
                    <% } else { %>
                        <span class="text-muted">-</span>
                    <% } %>
                </td>
                <% } %>
            </tr>
        <% }) %>
        </tbody>
    </table>
</body>
</html>


