<h1 class="mb-4">
    <%= title %>
</h1>

<!-- Auto-dismiss Success Notification -->
<% if (updated && parseInt(updated) > 0) { %>
    <div class="alert alert-success alert-dismissible fade show auto-dismiss" role="alert" data-timeout="5000">
        <i class="fas fa-check-circle me-2"></i>
        <strong>Berhasil!</strong> <%= updated %> laporan telah diperbarui.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        <div class="progress mt-2" style="height: 3px;">
            <div class="progress-bar bg-success progress-timer" role="progressbar" style="width: 100%;"></div>
        </div>
    </div>
<% } %>

<!-- Auto-dismiss Warning Notification -->
<% if (typeof errors !== 'undefined' && parseInt(errors) > 0) { %>
    <div class="alert alert-warning alert-dismissible fade show auto-dismiss" role="alert" data-timeout="7000">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <strong>Peringatan!</strong> 
        <% if (parseInt(updated) > 0) { %>
            <%= updated %> laporan berhasil diupdate, namun <%= errors %> laporan mungkin tidak terupdate.
        <% } else { %>
            <%= errors %> laporan tidak dapat diupdate.
        <% } %>
        Silakan coba lagi atau periksa data.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        <div class="progress mt-2" style="height: 3px;">
            <div class="progress-bar bg-warning progress-timer" role="progressbar" style="width: 100%;"></div>
        </div>
    </div>
<% } %>

<div class="d-flex gap-2 mb-3">
    <a href="/reports/add" class="btn btn-primary">
        <i class="fas fa-plus me-1"></i> Tambah Data
    </a>
    <a href="/reports/update" class="btn btn-warning">
        <i class="fas fa-edit me-1"></i> Update Data
    </a>
</div>

<div class="table-responsive">
    <table class="table table-bordered table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>No</th>
                <th>Platform</th>
                <th>Judul</th>
                <th>URL</th>
                <th>Like</th>
                <th>Komentar</th>
                <th>View</th>
                <th>Share</th>
                <th>Save</th>
                <th>Followers</th>
                <th>Tanggal Post</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody>
            <% if (reports.length > 0) { %>
                <% reports.forEach((report, index) => { %>
                    <tr>
                        <td><%= index + 1 %></td>
                        <td>
                            <span class="badge bg-primary">
                                <%= report.platform.toUpperCase() %>
                            </span>
                        </td>
                        <td class="text-truncate" style="max-width: 200px;" title="<%= report.judul %>">
                            <%= report.judul %>
                        </td>
                        <td>
                            <a href="<%= report.post_url %>" target="_blank" class="btn btn-sm btn-outline-info">
                                <i class="fas fa-external-link-alt"></i> Lihat
                            </a>
                        </td>
                        <td><%= Number(report.like_count).toLocaleString() %></td>
                        <td><%= Number(report.comment_count).toLocaleString() %></td>
                        <td><%= Number(report.view_count).toLocaleString() %></td>
                        <td><%= Number(report.share_count).toLocaleString() %></td>
                        <td><%= Number(report.save_count).toLocaleString() %></td>
                        <td><%= Number(report.follower_count).toLocaleString() %></td>
                        <td><%= formatDate(report.post_date) %></td>
                        <td>
                            <a href="/reports/delete/<%= report.id %>" 
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('Yakin ingin hapus laporan ini?')">
                                <i class="fas fa-trash"></i> Hapus
                            </a>
                        </td>
                    </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <td colspan="12" class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <div>Belum ada data laporan</div>
                    </td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-dismiss notifications
    const autoDismissAlerts = document.querySelectorAll('.auto-dismiss');
    
    autoDismissAlerts.forEach(alert => {
        const timeout = parseInt(alert.getAttribute('data-timeout')) || 5000;
        const progressBar = alert.querySelector('.progress-timer');
        
        if (progressBar) {
            // Animate progress bar
            progressBar.style.transition = `width ${timeout}ms linear`;
            setTimeout(() => {
                progressBar.style.width = '0%';
            }, 100);
        }
        
        // Auto close alert
        const timeoutId = setTimeout(() => {
            const alertInstance = new bootstrap.Alert(alert);
            alertInstance.close();
        }, timeout);
        
        // Clear timeout if user manually closes
        const closeButton = alert.querySelector('.btn-close');
        if (closeButton) {
            closeButton.addEventListener('click', () => {
                clearTimeout(timeoutId);
            });
        }
        
        // Pause timer on hover
        alert.addEventListener('mouseenter', () => {
            if (progressBar) {
                progressBar.style.animationPlayState = 'paused';
            }
        });
        
        alert.addEventListener('mouseleave', () => {
            if (progressBar) {
                progressBar.style.animationPlayState = 'running';
            }
        });
    });
});
</script>

<style>
.auto-dismiss {
    position: relative;
    overflow: hidden;
}

.progress-timer {
    transition: width linear;
}

.auto-dismiss:hover .progress-timer {
    animation-play-state: paused !important;
}

.table-responsive {
    border-radius: 0.375rem;
    overflow: hidden;
}

.table th {
    border-top: none;
    font-weight: 600;
    font-size: 0.875rem;
}

.badge {
    font-size: 0.75rem;
}

.text-truncate {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Smooth fade out animation */
.alert.fade.show {
    opacity: 1;
    transition: opacity 0.5s ease-out;
}

.alert.fade:not(.show) {
    opacity: 0;
}
</style>